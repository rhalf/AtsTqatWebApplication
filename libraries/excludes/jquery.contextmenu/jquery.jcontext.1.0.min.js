(function ($) {
    $.fn.showMenu = function (options) {
        var opts = $.extend({}, $.fn.showMenu.defaults, options);
        $(this).bind("click contextmenu", function (e) {
			var topval;
           if (e.pageY-opts.queryHeight<0){
			topval=0;
			}else if (e.pageY-opts.queryHeight>screen.availHeight){
			topval=screen.availHeight;	
			}else{
			topval=e.pageY-opts.queryHeight;	
			}
            $(opts.query).show().css({
              //  top: e.pageY - 210 + "px",
            //    left: e.pageX - z + "px",
			
			    top: topval  + "px",
                left: e.pageX-opts.queryWidth + "px",
                position: "fixed",
                opacity: opts.opacity,
                zIndex: opts.zindex
            });
            return false
        });
        var mouse_is_inside = false;
        $(document).ready(function () {
            $(opts.query).hover(function () {
                mouse_is_inside = true
            }, function () {
                mouse_is_inside = false
            });
            $("body").mouseup(function () {
                if (!mouse_is_inside) $(opts.query).hide()
            })
        })
    };
    $.fn.showMenu.defaults = {
        zindex: 2E3,
        query: document,
        opacity: 1,
		queryHeight:0,
		queryWidth:0
       // z: 0
	   
    }
})(jQuery);