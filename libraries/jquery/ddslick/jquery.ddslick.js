(function(d){d.fn.ddslick=function(k){if(b[k]){return b[k].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof k==="object"||!k){return b.init.apply(this,arguments)}else{d.error("Method "+k+" does not exists.")}}};var b={},c={data:[],keepJSONItemsOnTop:false,width:260,height:null,background:"none",selectText:"",defaultSelectedIndex:null,truncateDescription:true,imagePosition:"left",showSelectedHTML:true,clickOffToClose:true,onSelected:function(){}},h='<div class="dd-select"><input class="dd-selected-value" type="hidden" /><a class="dd-selected"></a><span class="dd-pointer dd-pointer-down"></span></div>',a='<ul class="dd-options"></ul>';b.init=function(k){var k=d.extend({},c,k);return this.each(function(){var o=d(this),p=o.data("ddslick");if(!p){var m=[],n=k.data;o.find("option").each(function(){var v=d(this),u=v.data();m.push({text:d.trim(v.text()),value:v.val(),selected:v.is(":selected"),description:u.description,imageSrc:u.imagesrc})});if(k.keepJSONItemsOnTop){d.merge(k.data,m)}else{k.data=d.merge(m,k.data)}var l=o,r=d('<div id="'+o.attr("id")+'"></div>');o.replaceWith(r);o=r;o.addClass("dd-container").append(h).append(a);var m=o.find(".dd-select"),t=o.find(".dd-options");t.css({width:k.width});m.css({width:k.width,background:k.background});o.css({width:k.width});if(k.height!=null){t.css({height:k.height,overflow:"auto"})}d.each(k.data,function(u,v){if(v.selected){k.defaultSelectedIndex=u}t.append('<li><a class="dd-option">'+(v.value?' <input class="dd-option-value" type="hidden" value="'+v.value+'" />':"")+(v.imageSrc?' <img class="dd-option-image'+(k.imagePosition=="right"?" dd-image-right":"")+'" src="'+v.imageSrc+'" />':"")+(v.text?' <label class="dd-option-text">'+v.text+"</label>":"")+(v.description?' <small class="dd-option-description dd-desc">'+v.description+"</small>":"")+"</a></li>")});var s={settings:k,original:l,selectedIndex:-1,selectedItem:null,selectedData:null};o.data("ddslick",s);if(k.selectText.length>0&&k.defaultSelectedIndex==null){o.find(".dd-selected").html(k.selectText)}else{var q=(k.defaultSelectedIndex!=null&&k.defaultSelectedIndex>=0&&k.defaultSelectedIndex<k.data.length)?k.defaultSelectedIndex:0;i(o,q)}o.find(".dd-select").on("click.ddslick",function(){e(o)});o.find(".dd-option").on("click.ddslick",function(){i(o,d(this).closest("li").index())});if(k.clickOffToClose){t.addClass("dd-click-off-close");o.on("click.ddslick",function(u){u.stopPropagation()});d("body").on("click",function(){d(".dd-click-off-close").slideUp(50).siblings(".dd-select").find(".dd-pointer").removeClass("dd-pointer-up")})}}})};b.select=function(k){return this.each(function(){i(d(this),k.index)})};b.open=function(){return this.each(function(){var l=d(this),k=l.data("ddslick");if(k){e(l)}})};b.close=function(){return this.each(function(){var l=d(this),k=l.data("ddslick");if(k){j(l)}})};b.destroy=function(){return this.each(function(){var m=d(this),l=m.data("ddslick");if(l){var k=l.original;m.removeData("ddslick").unbind(".ddslick").replaceWith(k)}})};function i(p,r){var t=p.data("ddslick");var q=p.find(".dd-selected"),m=q.siblings(".dd-selected-value"),u=p.find(".dd-options"),k=q.siblings(".dd-pointer"),o=p.find(".dd-option").eq(r),l=o.closest("li"),n=t.settings,s=t.settings.data[r];p.find(".dd-option").removeClass("dd-option-selected");o.addClass("dd-option-selected");t.selectedIndex=r;t.selectedItem=l;t.selectedData=s;if(n.showSelectedHTML){q.html((s.imageSrc?'<img class="dd-selected-image'+(n.imagePosition=="right"?" dd-image-right":"")+'" src="'+s.imageSrc+'" />':"")+(s.text?'<label class="dd-selected-text">'+s.text+"</label>":"")+(s.description?'<small class="dd-selected-description dd-desc'+(n.truncateDescription?" dd-selected-description-truncated":"")+'" >'+s.description+"</small>":""))}else{q.html(s.text)}m.val(s.value);t.original.val(s.value);p.data("ddslick",t);j(p);f(p);if(typeof n.onSelected=="function"){n.onSelected.call(this,t)}}function e(o){var n=o.find(".dd-select"),l=n.siblings(".dd-options"),k=n.find(".dd-pointer"),m=l.is(":visible");d(".dd-click-off-close").not(l).slideUp(50);d(".dd-pointer").removeClass("dd-pointer-up");if(m){l.slideUp("fast");k.removeClass("dd-pointer-up")}else{l.slideDown("fast");k.addClass("dd-pointer-up")}g(o)}function j(k){k.find(".dd-options").slideUp(50);k.find(".dd-pointer").removeClass("dd-pointer-up").removeClass("dd-pointer-up")}function f(n){var m=n.find(".dd-select").css("height");var l=n.find(".dd-selected-description");var k=n.find(".dd-selected-image");if(l.length<=0&&k.length>0){n.find(".dd-selected-text").css("lineHeight",m)}}function g(k){k.find(".dd-option").each(function(){var o=d(this);var m=o.css("height");var n=o.find(".dd-option-description");var l=k.find(".dd-option-image");if(n.length<=0&&l.length>0){o.find(".dd-option-text").css("lineHeight",m)}})}})(jQuery);