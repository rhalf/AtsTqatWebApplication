/*!
 * jQuery UI Menubar @VERSION
 * http://jqueryui.com
 *
 * Copyright 2013 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/menubar/
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *	jquery.ui.position.js
 *	jquery.ui.menu.js
 */
(function(a){a.widget("ui.menubar",{version:"@VERSION",options:{items:"li",menus:"ul",icons:{dropdown:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom"},select:null},_create:function(){this.menuItems=this.element.children(this.options.items);this.items=this.menuItems.children("button, a");this.openSubmenus=0;this._initializeWidget();this._initializeMenuItems();this._initializeItems()},_initializeWidget:function(){this.element.addClass("ui-menubar ui-state-default ui-helper-clearfix").attr("role","menubar");this._on({keydown:function(b){var c;if(b.keyCode===a.ui.keyCode.ESCAPE&&this.active&&this.active.menu("collapse",b)!==true){c=this.active;this.active.blur();this._close(b);a(b.target).blur().mouseleave();c.prev().focus()}},focusin:function(){clearTimeout(this.closeTimer)},focusout:function(b){this.closeTimer=this._delay(function(){this._close(b);this.items.attr("tabIndex",-1);this.lastFocused.attr("tabIndex",0)},150)},"mouseenter .ui-menubar-item":function(){clearTimeout(this.closeTimer)}})},_initializeMenuItems:function(){var c,b=this;this.menuItems.addClass("ui-menubar-item").attr("role","presentation").css({"border-width":"1px","border-style":"hidden"});c=this.menuItems.children(b.options.menus).menu({position:{within:this.options.position.within},select:function(d,e){e.item.parents("ul.ui-menu:last").hide();b._close();e.item.parents(".ui-menubar-item").children().first().focus();b._trigger("select",d,e)},menus:this.options.menus}).hide().attr({"aria-hidden":"true","aria-expanded":"false"});this._on(c,{keydown:function(d){a(d.target).attr("tabIndex",0);var e,f=a(this);if(f.is(":hidden")){return}switch(d.keyCode){case a.ui.keyCode.LEFT:e=b.active.prev(".ui-button");if(this.openSubmenus){this.openSubmenus--}else{if(this._hasSubMenu(e.parent().prev())){b.active.blur();b._open(d,e.parent().prev().find(".ui-menu"))}else{e.parent().prev().find(".ui-button").focus();b._close(d);this.open=true}}d.preventDefault();a(d.target).attr("tabIndex",-1);break;case a.ui.keyCode.RIGHT:this.next(d);d.preventDefault();break}},focusout:function(d){a(d.target).removeClass("ui-state-focus")}});this.menuItems.each(function(d,e){b._identifyMenuItemsNeighbors(a(e),b,d)})},_hasSubMenu:function(b){return a(b).children(this.options.menus).length>0},_identifyMenuItemsNeighbors:function(e,g,c){var f=this.menuItems.length,b=(c===0),d=(c===(f-1));if(b){e.data("prevMenuItem",a(this.menuItems[f-1]));e.data("nextMenuItem",a(this.menuItems[c+1]))}else{if(d){e.data("nextMenuItem",a(this.menuItems[0]));e.data("prevMenuItem",a(this.menuItems[c-1]))}else{e.data("nextMenuItem",a(this.menuItems[c+1]));e.data("prevMenuItem",a(this.menuItems[c-1]))}}},_initializeItems:function(){var b=this;this._focusable(this.items);this._hoverable(this.items);this.items.slice(1).attr("tabIndex",-1);this.items.each(function(c,d){b._initializeItem(a(d),b)})},_initializeItem:function(c){var b=this._hasSubMenu(c.parent());c.addClass("ui-button ui-widget ui-button-text-only ui-menubar-link").attr("role","menuitem").wrapInner("<span class='ui-button-text'></span>");this._on(c,{focus:function(d){c.attr("tabIndex",0);c.addClass("ui-state-focus");d.preventDefault()},focusout:function(d){c.attr("tabIndex",-1);this.lastFocused=c;c.removeClass("ui-state-focus");d.preventDefault()}});if(b){this._on(c,{click:this._mouseBehaviorForMenuItemWithSubmenu,focus:this._mouseBehaviorForMenuItemWithSubmenu,mouseenter:this._mouseBehaviorForMenuItemWithSubmenu});this._on(c,{keydown:function(d){switch(d.keyCode){case a.ui.keyCode.SPACE:case a.ui.keyCode.UP:case a.ui.keyCode.DOWN:this._open(d,a(d.target).next());d.preventDefault();break;case a.ui.keyCode.LEFT:this.previous(d);d.preventDefault();break;case a.ui.keyCode.RIGHT:this.next(d);d.preventDefault();break;case a.ui.keyCode.TAB:break}}});c.attr("aria-haspopup","true");if(this.options.icons){c.append("<span class='ui-button-icon-secondary ui-icon "+this.options.icons.dropdown+"'></span>");c.removeClass("ui-button-text-only").addClass("ui-button-text-icon-secondary")}}else{this._on(c,{click:function(){if(this.active){this._close()}else{this.open=true;this.active=a(c).parent()}},mouseenter:function(){if(this.open){this.stashedOpenMenu=this.active;this._close()}},keydown:function(d){if(d.keyCode===a.ui.keyCode.LEFT){this.previous(d);d.preventDefault()}else{if(d.keyCode===a.ui.keyCode.RIGHT){this.next(d);d.preventDefault()}}}})}},_mouseBehaviorForMenuItemWithSubmenu:function(c){var b,d;if(c.type==="focus"&&!c.originalEvent){return}c.preventDefault();d=a(c.target).parents(".ui-menubar-item").children(this.options.menus);b=c.type==="click"&&d.is(":visible")&&this.active&&this.active[0]===d[0];if(b){this._close();return}if(c.type==="mouseenter"){this.element.find(":focus").focusout();if(this.stashedOpenMenu){this._open(c,d)}this.stashedOpenMenu=undefined}if((this.open&&c.type==="mouseenter")||c.type==="click"){clearTimeout(this.closeTimer);this._open(c,d);c.stopPropagation()}},_destroy:function(){this.menuItems.removeClass("ui-menubar-item").removeAttr("role").css({"border-width":"","border-style":""});this.element.removeClass("ui-menubar ui-widget-header ui-helper-clearfix").removeAttr("role").unbind(".menubar");this.items.unbind(".menubar").removeClass("ui-button ui-widget ui-button-text-only ui-menubar-link ui-state-default").removeAttr("role").removeAttr("aria-haspopup").children(".ui-icon").remove();if(false){this.items.children("span.ui-button-text").unwrap()}else{this.items.children("span.ui-button-text").each(function(){var b=a(this);b.parent().html(b.html())})}this.element.find(":ui-menu").menu("destroy").show().removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("tabindex").unbind(".menubar")},_collapseActiveMenu:function(){if(!this.active.is(":ui-menu")){return}this.active.menu("collapseAll").hide().attr({"aria-hidden":"true","aria-expanded":"false"}).closest(this.options.items).removeClass("ui-state-active")},_close:function(){if(!this.active){return}this._collapseActiveMenu();this.active=null;this.open=false;this.openSubmenus=0},_open:function(c,d){var b=d.closest(".ui-menubar-item");if(this.active&&this.active.length&&this._hasSubMenu(this.active.closest(this.options.items))){this._collapseActiveMenu()}b.addClass("ui-state-active");if(!this.lastFocused){this.lastFocused=d.prev()}this.active=d.show().position(a.extend({of:b},this.options.position)).removeAttr("aria-hidden").attr("aria-expanded","true").menu("focus",c,d.children(".ui-menu-item").first()).focus();this.open=true},next:function(c){function b(){return this.active&&this._hasSubMenu(this.active.closest(this.options.items))&&this.active.data("uiMenu")&&this.active.data("uiMenu").active&&this.active.data("uiMenu").active.has(".ui-menu").length}if(this.open){if(b.call(this)){this.openSubmenus++;return}}this.openSubmenus=0;this._move("next",c)},previous:function(b){if(this.open&&this.openSubmenus){this.openSubmenus--;return}this.openSubmenus=0;this._move("prev",b)},_move:function(e,d){var c=a(d.target).closest(".ui-menubar-item"),b=c.data(e+"MenuItem"),f=b.find(".ui-button");if(this.open){if(this._hasSubMenu(b)){this._open(d,b.children(".ui-menu"))}else{this._collapseActiveMenu();b.find(".ui-button").focus();this.open=true}}else{c.find(".ui-button");f.focus()}}})}(jQuery));